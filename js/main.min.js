var outLog,writeLog,recordContentText;var adapter;function initPage(){outLog=document.getElementById("outLog");writeLog=document.getElementById("writeLog");recordContentText=document.getElementById("recordContentText");adapter=nfc.getDefaultAdapter();adapter.setPowered(true);readNFCTag(false);}function clearResults(){outLog.innerHTML="";writeLog.innerHTML="";recordContentText.value="";}function logRecord(a){if(a.text){outLog.innerHTML+="<li>"+a.text+" ("+a.encoding+" / "+a.languageCode+")</li>";}else{if(a.uri){outLog.innerHTML+="<li><a href='"+a.uri+"'>"+a.uri+"</a></li>";}}}function logMessage(b){outLog.innerHTML+="<ul>";for(var a=0;a<b.records.length;a++){logRecord(b.records[a]);}outLog.innerHTML+="</ul>";}function readOnAttach(a){outLog.innerHTML+="<hr><b>Tag found</b><br>";outLog.innerHTML+="Tag type:"+a.type+"<br>";a.readNDEF(logMessage);}function readNFCTag(a){adapter.setPolling(a);if(a){adapter.setTagListener({onattach:readOnAttach,ondetach:function(){outLog.innerHTML+="<br><b>Tag was read, detached</b><br>";}});document.tagManagement.tagListener.selectedIndex=1;}else{adapter.unsetTagListener();document.tagManagement.tagListener.selectedIndex=0;}}var messageToWrite;function writeOnAttach(a){if(!messageToWrite){alert("No message to write");}a.writeNDEF(messageToWrite);if(messageToWrite.records[0].text){writeLog.innerHTML="<b>Wrote text message:</b> "+messageToWrite.records[0].text;}else{if(messageToWrite.records[0].uri){writeLog.innerHTML="<b>Wrote URI:</b> "+messageToWrite.records[0].uri;}else{writeLog.innerHTML="<b>Wrote undefined content</b> ";}}}function writeRecordURL(b){readNFCTag(false);writeLog.innerHTML="Approach Tag to write URI...";var a=new NDEFRecordURI(b);messageToWrite=new NDEFMessage([a]);adapter.setTagListener({onattach:writeOnAttach,ondetach:function(){outLog.innerHTML+="<br><b>URI was written, detached</b><br>";adapter.unsetTagListener();}});adapter.setPolling(true);}function writeRecordText(b){readNFCTag(false);writeLog.innerHTML="Approach Tag to write Text...";var a=new NDEFRecordText(b,"en-US","UTF-8");messageToWrite=new NDEFMessage([a]);adapter.setTagListener({onattach:writeOnAttach,ondetach:function(){outLog.innerHTML+="<br><b>Text was written, detached</b><br>";adapter.unsetTagListener();}});adapter.setPolling(true);}function debugLog(a){alert(a);}var manifest={name:"cloud-neard",version:"development",key:"Neard",permissions:["org.neard"]};var init=function(){var b="localhost";var f="9000";var g=window.location.toString().split("?")[1];if(g){var a=g.split("&");for(var c=0;c<a.length;c++){var e=a[c].split("=");if(e.length==2){if(e[0]=="host"){b=e[1];}else{if(e[0]=="port"){f=e[1];}}}}}var d="ws://"+b+":"+f;nfc.init(d,manifest,initPage,debugLog);};window.onload=init;